"""
정밀 분석(구매오더 미결) 시 프론트에 내려줄 목업 데이터 생성용 유틸.
실제 DB 연동 전까지 /ask 결과를 이 데이터로 채워 연출할 때 사용하세요.
"""

from typing import Any, Dict, List


def get_mock_po_open_payload(question: str) -> Dict[str, Any]:
    """
    구매오더 미결 보고서용 고정 데이터 반환.
    /api/v1/ask 응답 형태와 최대한 비슷하게 구성했습니다.
    """

    # 메인 차트 데이터 (알림등급 분포)
    main_rows = [
        {"알림등급": "정상", "건수": 15650},
        {"알림등급": "확인필요", "건수": 1284},
        {"알림등급": "경고", "건수": 386},
    ]

    # 서브 분석들
    sub_analyses: List[Dict[str, Any]] = [
        {
            "name": "일별 미결 추이",
            "chart_spec": {"type": "line", "x_field": "일자", "y_field": "건수", "title": "일별 미결"},
            "rows": [
                {"일자": "11-01", "건수": 240},
                {"일자": "11-05", "건수": 310},
                {"일자": "11-10", "건수": 420},
                {"일자": "11-15", "건수": 490},
                {"일자": "11-21", "건수": 1127},
                {"일자": "11-25", "건수": 520},
                {"일자": "11-30", "건수": 1670},
            ],
        },
        {
            "name": "일별 경고 추이",
            "chart_spec": {"type": "line", "x_field": "일자", "y_field": "경고건수", "title": "일별 경고"},
            "rows": [
                {"일자": "11-01", "경고건수": 180},
                {"일자": "11-05", "경고건수": 210},
                {"일자": "11-10", "경고건수": 320},
                {"일자": "11-15", "경고건수": 360},
                {"일자": "11-21", "경고건수": 360},
                {"일자": "11-25", "경고건수": 380},
                {"일자": "11-30", "경고건수": 386},
            ],
        },
        {
            "name": "경과일수 분포",
            "chart_spec": {"type": "bar", "x_field": "구간", "y_field": "건수", "title": "경과일수 히스토그램"},
            "rows": [
                {"구간": "0-5", "건수": 520},
                {"구간": "6-10", "건수": 480},
                {"구간": "11-13", "건수": 274},
                {"구간": "14-20", "건수": 260},
                {"구간": "21-29", "건수": 136},
            ],
        },
        {
            "name": "플랜트별 경고 Top",
            "chart_spec": {"type": "bar", "x_field": "플랜트", "y_field": "경고건수", "title": "플랜트별 경고"},
            "rows": [
                {"플랜트": "경산공장", "경고건수": 257},
                {"플랜트": "경주1공장", "경고건수": 57},
                {"플랜트": "경주3공장", "경고건수": 51},
                {"플랜트": "경주4공장", "경고건수": 11},
                {"플랜트": "경주2공장", "경고건수": 10},
            ],
        },
        {
            "name": "생성자별 경고 파레토",
            "chart_spec": {"type": "bar", "x_field": "생성자", "y_field": "경고건수", "title": "생성자별 경고"},
            "rows": [
                {"생성자": "윤주임", "경고건수": 192},
                {"생성자": "장주임", "경고건수": 68},
                {"생성자": "조주임", "경고건수": 57},
                {"생성자": "류주임", "경고건수": 49},
                {"생성자": "기타", "경고건수": 20},
            ],
        },
        {
            "name": "대표차종별 경고 Top",
            "chart_spec": {"type": "bar", "x_field": "차종", "y_field": "경고건수", "title": "차종별 경고"},
            "rows": [
                {"차종": "CN7", "경고건수": 86},
                {"차종": "MQ4", "경고건수": 51},
                {"차종": "COMM.", "경고건수": 40},
                {"차종": "LX3", "경고건수": 34},
                {"차종": "MQ4 HEV", "경고건수": 32},
            ],
        },
        {
            "name": "공급업체 리스크 매트릭스",
            "chart_spec": {"type": "scatter", "x_field": "미결건수", "y_field": "경고비율", "title": "공급업체 리스크"},
            "rows": [
                {"업체": "A업체", "미결건수": 120, "경고비율": 0.42},
                {"업체": "B업체", "미결건수": 80, "경고비율": 0.28},
                {"업체": "C업체", "미결건수": 55, "경고비율": 0.10},
                {"업체": "D업체", "미결건수": 35, "경고비율": 0.32},
                {"업체": "E업체", "미결건수": 18, "경고비율": 0.95},
            ],
        },
    ]

    table_rows = [
        {"플랜트명": "경산공장", "대표차종": "MQ4", "구매오더": "4,600,002,408", "구매오더품목": "40", "공급업체명": "디에이치(주)", "자재번호": "64312-KL000", "내역": "PNL-DASH UPR", "생성일": "2025-11-01", "경과일수": 29, "납품요청일": "2025-11-12", "오더수량": 9000},
        {"플랜트명": "경산공장", "대표차종": "MQ4", "구매오더": "4,600,002,410", "구매오더품목": "40", "공급업체명": "디에이치(주)", "자재번호": "64312-KL000", "내역": "PNL-DASH UPR", "생성일": "2025-11-01", "경과일수": 29, "납품요청일": "2025-11-26", "오더수량": 9000},
        {"플랜트명": "경산공장", "대표차종": "CN7", "구매오더": "4,600,002,418", "구매오더품목": "10", "공급업체명": "성심정밀(주)", "자재번호": "64658-AA000", "내역": "BRKT-SUB FRAME MTG RR,LH", "생성일": "2025-11-01", "경과일수": 29, "납품요청일": "2025-11-19", "오더수량": 9000},
        {"플랜트명": "경산공장", "대표차종": "CN7", "구매오더": "4,600,002,416", "구매오더품목": "30", "공급업체명": "정하이텍", "자재번호": "64542-AA500", "내역": "COVER-S/ABS HSG,RH", "생성일": "2025-11-01", "경과일수": 29, "납품요청일": "2025-11-12", "오더수량": 9000},
        {"플랜트명": "경산공장", "대표차종": "ME", "구매오더": "4,600,002,408", "구매오더품목": "70", "공급업체명": "디에이치(주)", "자재번호": "64314-GO000", "내역": "PNL-DASH LWR", "생성일": "2025-11-01", "경과일수": 29, "납품요청일": "2025-11-12", "오더수량": 9000},
        {"플랜트명": "경산공장", "대표차종": "ME", "구매오더": "4,600,002,410", "구매오더품목": "70", "공급업체명": "디에이치(주)", "자재번호": "64314-GO000", "내역": "PNL-DASH LWR", "생성일": "2025-11-01", "경과일수": 29, "납품요청일": "2025-11-26", "오더수량": 9000},
        {"플랜트명": "경산공장", "대표차종": "MQ4", "구매오더": "4,600,002,425", "구매오더품목": "50", "공급업체명": "신영하이테크", "자재번호": "65222-P2000", "내역": "MEMBER-CTR FLOOR SIDE,RH", "생성일": "2025-11-01", "경과일수": 29, "납품요청일": "2025-11-19", "오더수량": 9000},
        {"플랜트명": "경산공장", "대표차종": "MQ4 HEV", "구매오더": "4,600,002,430", "구매오더품목": "20", "공급업체명": "신영하이테크", "자재번호": "65152-P2000", "내역": "MEMBER-FR SEAT CROSS,LH", "생성일": "2025-11-01", "경과일수": 29, "납품요청일": "2025-11-20", "오더수량": 9000},
        {"플랜트명": "경산공장", "대표차종": "COMM.", "구매오더": "4,600,002,450", "구매오더품목": "30", "공급업체명": "OO머티리얼", "자재번호": "77004-P9010", "내역": "MEMBER-CTR", "생성일": "2025-11-02", "경과일수": 28, "납품요청일": "2025-11-21", "오더수량": 8000},
        {"플랜트명": "경산공장", "대표차종": "CN7", "구매오더": "4,600,002,455", "구매오더품목": "20", "공급업체명": "성심정밀(주)", "자재번호": "64668-AA000", "내역": "BRKT-SUB FRAME MTG RR,RH", "생성일": "2025-11-02", "경과일수": 28, "납품요청일": "2025-11-21", "오더수량": 8000},
    ]

    insight_text = (
        "11월 생성분 17,320건 중 미결 1,670건(9.64%), 경고 386건(23.1%). "
        "미결 비고 기재율 0%로 사유 추적 불가. 11/21 미결 스파이크(1,127건)와 경산공장·MQ4 차종·상위 4명 생성자 편중이 핵심."
    )

    return {
        "question": question,
        "action": "po_open_mock",
        "sql": "/* mock */",
        "rows": main_rows,
        "chart_spec": {"type": "bar", "x_field": "알림등급", "y_field": "건수", "title": "알림등급 분포"},
        "row_count": len(main_rows),
        "insight": insight_text,
        "sub_analyses": sub_analyses,
        "table_rows": table_rows,
        "kpis": {
            "total_cnt": 17320,
            "done_cnt": 15650,
            "open_cnt": 1670,
            "warn_cnt": 386,
            "check_cnt": 1284,
            "open_rate_pct": 9.64,
            "warn_rate_open_pct": 23.11,
            "check_rate_open_pct": 76.89,
        },
    }
